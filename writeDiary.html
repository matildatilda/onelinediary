<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <title>今日の日記</title>
<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script type="text/javascript">
function onSubmit()
{
    var url;
    if ($("#diary_id").val() == 0)
    {
        url = "php/insertDiary.php";

        $.post(url, 
            {
                "year" :  $("#year").val(),
                "month" : $("#month").val(),
                "day" : $("#day").val(),
                "diary" : $("#diary").val()
            },
            function(data)
            {
            }
        );
    }
    else
    {
        url = "php/updateDiary.php";

        $.post(url, 
            {
                "diary_id" :  $("#diary_id").val(),
                "diary" : $("#diary").val()
            },
            function(data)
            {
            }
        );
    }
}
function onLoad()
{
    var url = location.href;
    var parameter = url.split("?");
    if (1 < parameter.length)
    {
        var params = parameter[1].split("&");
        var i;
        var param;
        for (i = 0; i < params.length; i++)
        {
            param = params[i].split("=");
            if (param[0]=="diary_id")
            {
                $.get("php/selectDiaries.php/?diary_id=" + param[1], function(data)
                {
                    $("#diary").val(data[0].diary);
                    $("#year").val(data[0].year);
                    $("#month").val(data[0].month);
                    $("#day").val(data[0].day);
                    $("#diary_id").val(param[1]);
                });
                break;
            }
        }
    }
    else
    {
        var today = new Date();
        $("#year").val(today.getFullYear());
        $("#month").val(today.getMonth() + 1);
        $("#day").val(today.getDate());
        $("#diary_id").val(0);
    }
}
function onDelete()
{
    var url = "php/deleteDiary.php";

    $.post(url, 
        {
            "diary_id" :  $("#diary_id").val()
        },
        function(data)
        {
        }
    );    
}
$(document).ready(function()
{
    $("#submit").on("click", function(){
        onSubmit();        
    });
    $("#delete").on("click", function(){
        onDelete();
    });
    
    onLoad();
});
</script>
<style type="text/css">
textarea.sample_01
{
width: 300px;    
}
input.sample_01 
{
width: 60px;
}
</style>
    </head>
    <body>
    <div>
        <p id="today"></p>
        <div>
            <input class="sample_01" type="text" id="year" value=""/>
            <input class="sample_01" type="text" id="month" value=""/>
            <input class="sample_01" type="text" id="day" value=""/>
            <input type="hidden" id="diary_id" value="0"/>
            <br/>
            <textarea class="sample_01" name="diary" id="diary"></textarea>
            <br/>
            <button id="submit">送信</button>
            <button id="delete">削除</button>
        </div>
    </div>
    <a href="onelinediary.html">一覧に戻る</a>
    </body>
</html>